# GUSTAV local environment example (do not commit secrets)

# App environment
GUSTAV_ENV=dev
GUSTAV_TRUST_PROXY=false  # set to true only when running behind a trusted reverse proxy

# Database DSNs — details in docs/references/config_matrix.md
# Security: use a login role IN ROLE `gustav_limited` (never log in as gustav_limited itself).
APP_DB_USER=gustav_app
APP_DB_PASSWORD=CHANGE_ME_DEV
DATABASE_URL=postgresql://${APP_DB_USER}:${APP_DB_PASSWORD}@127.0.0.1:54322/postgres
RLS_TEST_DSN=postgresql://${APP_DB_USER}:${APP_DB_PASSWORD}@127.0.0.1:54322/postgres
# Prod/Stage: TEACHING_DATABASE_URL / LEARNING_DATABASE_URL müssen explizit gesetzt werden (keine Fallbacks).

# Sessions (optional DB-backed)
# SESSIONS_BACKEND=db
# SESSION_DATABASE_URL=postgresql://postgres:postgres@127.0.0.1:54322/postgres

# OIDC / Keycloak (siehe docs/references/identity_access.md)
# Interne Services nutzen http://keycloak:8080, Browser verwenden KC_PUBLIC_BASE_URL (TLS, Proxy).
KC_BASE_URL=http://keycloak:8080
KC_PUBLIC_BASE_URL=https://id.localhost
KC_REALM=gustav
KC_ADMIN_REALM=master
KC_ADMIN_CLIENT_ID=gustav-admin-cli
KC_ADMIN_CLIENT_SECRET=CHANGE_ME_DEV
# Legacy fallback (nur lokal)
# KC_ADMIN_USERNAME=admin
# KC_ADMIN_PASSWORD=admin
# Keycloak DB (dev defaults — prod override mit sslmode=require etc.)
KC_DB=postgres
KC_DB_URL=jdbc:postgresql://keycloak-db:5432/keycloak
KC_DB_USERNAME=keycloak
KC_DB_PASSWORD=keycloak
KC_DB_URL_PROPERTIES=sslmode=disable  # override with sslmode=require (and friends) in prod
# App base for browser-facing URLs (reverse proxy maps app.localhost → web)
WEB_BASE=https://app.localhost
REDIRECT_URI=https://app.localhost/auth/callback

# Supabase Storage (self-hosted) — siehe docs/references/storage_and_gateway.md
SUPABASE_URL=http://127.0.0.1:54321
SUPABASE_PUBLIC_URL=https://app.localhost
SUPABASE_SERVICE_ROLE_KEY=DUMMY_DO_NOT_USE
# Security: Service-Role-Key ist nur für Server; Prod bricht mit Dummy/leer sofort ab.
SUPABASE_STORAGE_BUCKET=materials
LEARNING_STORAGE_BUCKET=submissions
# Centralized size limits (bytes)
MATERIALS_MAX_UPLOAD_BYTES=20971520
LEARNING_MAX_UPLOAD_BYTES=10485760
# Dev-Only Convenience (siehe docs/ARCHITECTURE.md#storage-bootstrap-nur-devci)
AUTO_CREATE_STORAGE_BUCKETS=false

# Notes:
# - Keep this file as a template. Create a real `.env` with your secrets.
# - The backend loads `.env` automatically in dev/test.

# Local AI (siehe docs/references/learning_ai.md)
AI_BACKEND=local
OLLAMA_BASE_URL=http://ollama:11434
AI_VISION_MODEL=qwen2.5vl:3b
AI_FEEDBACK_MODEL=gpt-oss:latest
AI_TIMEOUT_VISION=30
AI_TIMEOUT_FEEDBACK=15
# DSPy JSONAdapter (true = strikt). Compose injiziert den Wert automatisch in den Worker.
# Logs: `docker compose logs -n 50 learning-worker | rg dspy_configured`.
LEARNING_DSPY_JSON_ADAPTER=true
