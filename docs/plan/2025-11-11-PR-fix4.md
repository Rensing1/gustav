# PR Review — fix4 (2025-11-11)

## Kurzfazit
Die Änderungen bringen klare Sicherheitsgewinne (CSRF/SSRF-Guards, strikte Cookies), saubere Storage-Zentrierung und bessere DX. Risiko gering; vereinzelte Konsistenzfehler mindern Lesbarkeit. Empfehlung: mit kleinen Nachbesserungen mergen.

## MUST-FIX
- [CONSISTENCY] Einheitliche AI-Default-Modelle — Evidenz: backend/learning/config.py:89-90@c3cebe2 — Impact: Verwirrung zw. Doku/ENV/Code — Fix: Defaults auf `qwen2.5vl:3b` (Vision) und `gpt-oss:latest` (Feedback) angleichen.

## SHOULD-FIX
- [CONSISTENCY] README/ENV Hinweise zu `SUPABASE_REWRITE_SIGNED_URL_HOST` im Abschnitt „Storage“ mit kurzer „Wann aktivieren?“‑Notiz ergänzen — Evidenz: README.md:25-110@c3cebe2 — Impact: weniger Setup-Reibung — Fix: 1–2 Sätze hinzufügen.
- [TEST] Kleinen Smoke-Test für `load_ai_config()` Defaults — Evidenz: backend/learning/config.py:61-106@c3cebe2 — Impact: verhindert künftige Drift — Fix: Unit-Test für Defaults + URL-Validierung.
- [CONSISTENCY] Überflüssige Leerzeilen in local_vision.py am Dateiende entfernen — Evidenz: backend/learning/adapters/local_vision.py:560-980@c3cebe2 — Impact: Stil-/Lint-Rauschen — Fix: Datei-Ende trimmen.

## NICE-TO-HAVE
- [CONSISTENCY] Einheitliche Modellnamen-Beispiele in Tests/Docs (llama3.1 vs qwen2.5vl) angleichen.

## Tests
- Given student + CSRF gleich Origin When POST upload-intents Then Response enthält kein `method` und nur dokumentierte Felder (backend/tests/test_learning_upload_intent_response_shape.py::test_upload_intent_response_does_not_include_method)
- Given ENABLE_STORAGE_UPLOAD_PROXY=true When PUT /api/learning/internal/upload-proxy Then 400/403/404/502 gemäß Vertrag (api/openapi.yml paths./api/learning/internal/upload-proxy)

## Refactor-Budget
S · Blast radius: Learning adapters + Config

## Freigabe
⚠️ Nachziehen der zwei Konsistenz-Fixes empfohlen. Sicherheits-/API-Aspekte solide, OpenAPI konsistent. Nach Umsetzung: ✅ mergebereit.
