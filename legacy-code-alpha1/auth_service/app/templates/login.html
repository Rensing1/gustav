<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title | default("GUSTAV Login") }}</title>
    <link rel="stylesheet" href="/auth/static/login.css">
    <link rel="icon" type="image/svg+xml" href="/auth/static/favicon.svg">
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <div class="logo-container">
                <img src="/auth/static/gustav-logo.png" alt="GUSTAV Logo" class="logo">
                <h1>GUSTAV</h1>
            </div>
            
            <h2>Willkommen zurÃ¼ck</h2>
            <p class="subtitle">Melden Sie sich mit Ihrer E-Mail-Adresse an</p>
            
            {% if logout_success %}
            <div class="alert alert-success">
                <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>Sie wurden erfolgreich abgemeldet.</span>
            </div>
            {% endif %}
            
            {% if registered %}
            <div class="alert alert-success">
                <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>Registrierung erfolgreich! Bitte bestÃ¤tigen Sie Ihre E-Mail-Adresse und melden Sie sich dann an.</span>
            </div>
            {% endif %}
            
            {% if error %}
            <div class="alert alert-error">
                <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>{{ error_messages.get(error, "Anmeldung fehlgeschlagen. Bitte versuchen Sie es erneut.") }}</span>
            </div>
            {% endif %}
            
            <!-- Baustellenhinweis auskommentiert
            <div class="alert alert-warning">
                <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
                <span>ðŸš§ Wartungsarbeiten â€“ GUSTAV ist vorÃ¼bergehend nicht erreichbar.</span>
            </div>
            -->
            
            <!-- Admin-Login (aktiviert durch Konami-Code) -->
            <div id="admin-login" style="display: none;">
                <div class="alert alert-success">
                    <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>ðŸ”‘ Administrator-Zugang aktiviert</span>
                </div>
                
                <form method="POST" action="/auth/login" class="login-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <input type="hidden" name="next" value="{{ next | default('/') }}">
                    
                    <div class="form-group">
                        <label for="email">E-Mail-Adresse</label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            required 
                            autofocus
                            placeholder="vorname.nachname@gymalf.de"
                            class="form-input"
                            autocomplete="username"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Passwort</label>
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            required
                            class="form-input"
                            autocomplete="current-password"
                        >
                    </div>
                    
                    <button type="submit" class="btn-primary">
                        Admin-Anmeldung
                    </button>
                </form>
            </div>
            
            <!-- Login-Formular wieder aktiv -->
            <form method="POST" action="/auth/login" class="login-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <input type="hidden" name="next" value="{{ next | default('/') }}">
                
                <div class="form-group">
                    <label for="email">E-Mail-Adresse</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        autofocus
                        placeholder="vorname.nachname@gymalf.de"
                        class="form-input"
                        autocomplete="username"
                    >
                </div>
                
                <div class="form-group">
                    <label for="password">Passwort</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required
                        class="form-input"
                        autocomplete="current-password"
                    >
                </div>
                
                <button type="submit" class="btn-primary">
                    Anmelden
                </button>
            </form>
            
            <div class="links">
                <p class="register-link">
                    Noch kein Konto? <a href="/auth/register">Registrieren</a>
                </p>
                <p class="forgot-link">
                    <a href="/auth/forgot-password">Passwort vergessen?</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Konami-Code fÃ¼r Admin-Login: â†‘ â†‘ â†“ â†“ â† â†’ â† â†’ B A
        const konamiCode = [
            'ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown',
            'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight',
            'KeyB', 'KeyA'
        ];
        
        let userInput = [];
        let timeout;
        
        document.addEventListener('keydown', function(event) {
            // Reset nach 5 Sekunden InaktivitÃ¤t
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                userInput = [];
            }, 5000);
            
            // Aktuelle Taste zur Eingabe hinzufÃ¼gen
            userInput.push(event.code);
            
            // Nur die letzten 10 Tasten behalten (LÃ¤nge des Konami-Codes)
            if (userInput.length > konamiCode.length) {
                userInput.shift();
            }
            
            // PrÃ¼fen ob Konami-Code eingegeben wurde
            if (userInput.length === konamiCode.length) {
                const isMatch = userInput.every((key, index) => key === konamiCode[index]);
                
                if (isMatch) {
                    const adminLogin = document.getElementById('admin-login');
                    if (adminLogin.style.display === 'none') {
                        // Admin-Login einblenden mit Animation
                        adminLogin.style.display = 'block';
                        adminLogin.style.opacity = '0';
                        adminLogin.style.transform = 'translateY(-10px)';
                        
                        // Smooth fade-in
                        setTimeout(() => {
                            adminLogin.style.transition = 'all 0.3s ease-in-out';
                            adminLogin.style.opacity = '1';
                            adminLogin.style.transform = 'translateY(0)';
                            
                            // Focus auf Email-Feld setzen
                            setTimeout(() => {
                                document.getElementById('email').focus();
                            }, 300);
                        }, 10);
                        
                        // Input zurÃ¼cksetzen
                        userInput = [];
                        
                        // Visuelles Feedback (kurzer Erfolgs-Flash)
                        document.body.style.backgroundColor = '#f0fdf4';
                        setTimeout(() => {
                            document.body.style.backgroundColor = '';
                        }, 200);
                    }
                }
            }
        });
    </script>
</body>
</html>